<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 OK with structural model and sampling variance | Naslund Chapter 1 Analysis</title>
  <meta name="description" content="This is the documentation of an analysis of spatial and temporal variability of greenhouse gas emissions from small reservoirs" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 OK with structural model and sampling variance | Naslund Chapter 1 Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the documentation of an analysis of spatial and temporal variability of greenhouse gas emissions from small reservoirs" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 OK with structural model and sampling variance | Naslund Chapter 1 Analysis" />
  
  <meta name="twitter:description" content="This is the documentation of an analysis of spatial and temporal variability of greenhouse gas emissions from small reservoirs" />
  

<meta name="author" content="Laura Naslund" />


<meta name="date" content="2023-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ordinary-kriging-just-in-space.html"/>
<link rel="next" href="footnotes-and-citations.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="libs/co2.kriged[5] - 1_a548fe-1/data_stars_co2kriged51576b0a.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/co2.kriged.sim.sk[4, , , 1] - 1_524e03-1/data_stars_co2krigedsimsk411e06932.txt"></script>
<script src="libs/co2.kriged.sim.sk[4, , , 2] - 1_bac6e0-1/data_stars_co2krigedsimsk421694af1.txt"></script>
<script src="libs/co2.kriged.sim.sk[4, , , 3] - 1_817b53-1/data_stars_co2krigedsimsk431c1043e.txt"></script>
<script src="libs/co2.kriged.sim.sk[4, , , 4] - 1_5ec624-1/data_stars_co2krigedsimsk441853ceb.txt"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Naslund Chapter 1 Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Sampling scheme</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#dissolved-oxygen"><i class="fa fa-check"></i><b>1.1</b> Dissolved oxygen</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#deans"><i class="fa fa-check"></i><b>1.1.1</b> Deans</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#catfish"><i class="fa fa-check"></i><b>1.1.2</b> Catfish</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#sister-3"><i class="fa fa-check"></i><b>1.1.3</b> Sister 3</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#pick"><i class="fa fa-check"></i><b>1.1.4</b> Pick</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#all-impoundments-top-do"><i class="fa fa-check"></i><b>1.1.5</b> All impoundments top DO</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#temperature"><i class="fa fa-check"></i><b>1.2</b> Temperature</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#deans-1"><i class="fa fa-check"></i><b>1.2.1</b> Deans</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#catfish-1"><i class="fa fa-check"></i><b>1.2.2</b> Catfish</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#sister-3-1"><i class="fa fa-check"></i><b>1.2.3</b> Sister 3</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#pick-1"><i class="fa fa-check"></i><b>1.2.4</b> Pick</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#label"><i class="fa fa-check"></i><b>1.3</b> Residence time calculation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html"><i class="fa fa-check"></i><b>2</b> Diffusive emissions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#deans-81622-81722"><i class="fa fa-check"></i><b>2.1</b> Deans 8/16/22-8/17/22</a></li>
<li class="chapter" data-level="2.2" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#deans-83022-83122"><i class="fa fa-check"></i><b>2.2</b> Deans 8/30/22-8/31/22</a></li>
<li class="chapter" data-level="2.3" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#catfish-9622-9722"><i class="fa fa-check"></i><b>2.3</b> Catfish 9/6/22-9/7/22</a></li>
<li class="chapter" data-level="2.4" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#catfish-91822-91922-sunny"><i class="fa fa-check"></i><b>2.4</b> Catfish 9/18/22-9/19/22 (Sunny)</a></li>
<li class="chapter" data-level="2.5" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#pick-91322--91422"><i class="fa fa-check"></i><b>2.5</b> Pick 9/13/22- 9/14/22</a></li>
<li class="chapter" data-level="2.6" data-path="diffusive-emissions.html"><a href="diffusive-emissions.html#sister3-82222-82322"><i class="fa fa-check"></i><b>2.6</b> Sister3 8/22/22-8/23/22</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ebullition.html"><a href="ebullition.html"><i class="fa fa-check"></i><b>3</b> Ebullition</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ebullition.html"><a href="ebullition.html#deans-81622-81722-1"><i class="fa fa-check"></i><b>3.1</b> Deans 8/16/22-8/17/22</a></li>
<li class="chapter" data-level="3.2" data-path="ebullition.html"><a href="ebullition.html#deans-83022-83122-1"><i class="fa fa-check"></i><b>3.2</b> Deans 8/30/22-8/31/22</a></li>
<li class="chapter" data-level="3.3" data-path="ebullition.html"><a href="ebullition.html#catfish-90622-90722-clouds-cleared-by-9am-sparce-clouds-until-4-cleared-around-7-overcast-the-next-morning"><i class="fa fa-check"></i><b>3.3</b> Catfish 9/06/22-9/07/22 (Clouds cleared by 9AM, sparce clouds until ~ 4, cleared around 7, overcast the next morning)</a></li>
<li class="chapter" data-level="3.4" data-path="ebullition.html"><a href="ebullition.html#catfish-91822-91922-cloudless-until-12-3-pretty-cloudy"><i class="fa fa-check"></i><b>3.4</b> Catfish 9/18/22-9/19/22 (cloudless until 12-3 pretty cloudy)</a></li>
<li class="chapter" data-level="3.5" data-path="ebullition.html"><a href="ebullition.html#pick-91322-91422"><i class="fa fa-check"></i><b>3.5</b> Pick 9/13/22-9/14/22</a></li>
<li class="chapter" data-level="3.6" data-path="ebullition.html"><a href="ebullition.html#sister-3-82222-82322"><i class="fa fa-check"></i><b>3.6</b> Sister 3 8/22/22-8/23/22</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ordinary-kriging-just-in-space.html"><a href="ordinary-kriging-just-in-space.html"><i class="fa fa-check"></i><b>4</b> Ordinary kriging just in space</a></li>
<li class="chapter" data-level="5" data-path="ok-with-structural-model-and-sampling-variance.html"><a href="ok-with-structural-model-and-sampling-variance.html"><i class="fa fa-check"></i><b>5</b> OK with structural model and sampling variance</a></li>
<li class="chapter" data-level="6" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>6</b> Footnotes and citations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>6.1</b> Footnotes</a></li>
<li class="chapter" data-level="6.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>6.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>7</b> Blocks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>7.1</b> Equations</a></li>
<li class="chapter" data-level="7.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>7.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="7.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>7.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>8</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>8.1</b> Publishing</a></li>
<li class="chapter" data-level="8.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>8.2</b> 404 pages</a></li>
<li class="chapter" data-level="8.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>8.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Naslund Chapter 1 Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ok-with-structural-model-and-sampling-variance" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> OK with structural model and sampling variance<a href="ok-with-structural-model-and-sampling-variance.html#ok-with-structural-model-and-sampling-variance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb60-2"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create fake data</span></span>
<span id="cb60-4"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># n_pts &lt;- 15</span></span>
<span id="cb60-5"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># conc &lt;- rbeta(5, 2, 1)*100*10000 # conc in ppm </span></span>
<span id="cb60-6"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># depth &lt;- rbeta(n_pts, 5, 15) * 10 # fake depths</span></span>
<span id="cb60-7"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># area &lt;- 0.0254469</span></span>
<span id="cb60-8"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># time &lt;- 3</span></span>
<span id="cb60-9"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># vol = rgamma(n_pts,1)</span></span>
<span id="cb60-10"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># lat = rnorm(n_pts, 0, 1)</span></span>
<span id="cb60-11"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># long = rnorm(n_pts, 0, 1)</span></span>
<span id="cb60-12"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-13"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # monte carlo parameters</span></span>
<span id="cb60-14"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># n_sims &lt;- 10</span></span>
<span id="cb60-15"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># flux_summary &lt;- NULL</span></span>
<span id="cb60-16"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse &lt;- NULL</span></span>
<span id="cb60-17"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-18"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in 1:n_sims){</span></span>
<span id="cb60-19"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # assign concentrations to volumes and calculate raw flux</span></span>
<span id="cb60-20"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   pts &lt;-</span></span>
<span id="cb60-21"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(</span></span>
<span id="cb60-22"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     vol =vol,</span></span>
<span id="cb60-23"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     lat = lat,</span></span>
<span id="cb60-24"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     long = long) %&gt;% </span></span>
<span id="cb60-25"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(conc_sampled = sample(conc, n_pts, replace = TRUE), </span></span>
<span id="cb60-26"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="co">#          depth = depth, </span></span>
<span id="cb60-27"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="co">#          flux_raw = vol * (1/area) * (1/time)* (1/10^9) * conc_sampled * 16.04 * (1/0.0821)* (1/293.15)) %&gt;% </span></span>
<span id="cb60-28"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_as_sf(coords = c(&quot;long&quot;, &quot;lat&quot;), crs = 4326)</span></span>
<span id="cb60-29"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-30"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="co"># # correct &quot;observed&quot; flux values using residual standard error from depth model</span></span>
<span id="cb60-31"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   rse &lt;- summary(lm(flux_raw ~ depth, data = pts))$sigma</span></span>
<span id="cb60-32"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Question: This allows fluxes to be negative which doesn&#39;t make sense for ebullition. Should I write in an additional constraint that flux_corr must be positive?</span></span>
<span id="cb60-33"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   pts &lt;- pts %&gt;% mutate(flux_corr= flux_raw %&gt;% map_dbl(~rnorm(1, mean = .x, sd =rse)))</span></span>
<span id="cb60-34"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb60-35"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co"># # create grid for kriging</span></span>
<span id="cb60-36"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   grid &lt;- st_as_stars(st_bbox(pts), dx = 0.1, dy = 0.1)</span></span>
<span id="cb60-37"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb60-38"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   # calculate empirical variogram</span></span>
<span id="cb60-39"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   v_emp_ok &lt;- variogram(flux_corr ~ 1, pts)</span></span>
<span id="cb60-40"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(v_emp_ok)</span></span>
<span id="cb60-41"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-42"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   # fit modeled variogram</span></span>
<span id="cb60-43"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Question: if you are fitting the variogram &quot;manually&quot; (not using autofit), you need to give the function starting parameters, and from what I gather from the internet, people typically eyeball the empirical variogram to get those starting parameters (e.g., sill, nugget, range), so I am not sure how to randomize manual fits except to autofit first and then maybe extract parameters from the model IDed by autofit as having the smallest rss and then applying them to randomly selected model. Because the data are changing by accounting for sampling variance and ebullition concentrations, does this even make sense? Presumably different model runs will have different variogram models using autofit.</span></span>
<span id="cb60-44"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   # auto fitting of variogram</span></span>
<span id="cb60-45"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   v_mod_ok = autofitVariogram(flux_corr ~ 1, as(pts, &quot;Spatial&quot;))</span></span>
<span id="cb60-46"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(v_mod_ok)</span></span>
<span id="cb60-47"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-48"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   # apply modeled variogram and krige</span></span>
<span id="cb60-49"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   g &lt;- gstat(formula = flux_corr ~ 1, model = v_mod_ok$var_model, data = pts)</span></span>
<span id="cb60-50"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   z &lt;- predict(g, grid)</span></span>
<span id="cb60-51"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   z &lt;- z[&quot;var1.pred&quot;,,]</span></span>
<span id="cb60-52"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   names(z) = &quot;flux&quot;</span></span>
<span id="cb60-53"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb60-54"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   # sum cells in the grid to get total flux</span></span>
<span id="cb60-55"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   flux_summary &lt;- c(flux_summary, sum(z$flux))</span></span>
<span id="cb60-56"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb60-57"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   # plot kriged grid</span></span>
<span id="cb60-58"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   b &lt;- seq(range(z$flux)[1], range(z$flux)[2], by = (range(z$flux)[2]-range(z$flux)[1])/10)</span></span>
<span id="cb60-59"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-60"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(z, breaks = b, col = hcl.colors(length(b)-1, &quot;Spectral&quot;), reset = FALSE)</span></span>
<span id="cb60-61"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot(st_geometry(pts), pch = 16, add = TRUE)</span></span>
<span id="cb60-62"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   contour(z, breaks = b, add = TRUE)</span></span>
<span id="cb60-63"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-64"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   # leave-one-out cross validation </span></span>
<span id="cb60-65"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   ou2 &lt;- krige.cv(flux_corr ~ 1, pts, v_mod_ok$var_model, nmax = n_pts, nfold = nrow(pts))</span></span>
<span id="cb60-66"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   rmse &lt;- c(rmse, sqrt(mean(out2$residual^2)))</span></span>
<span id="cb60-67"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-67" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb60-68"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb60-69"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-69" aria-hidden="true" tabindex="-1"></a><span class="co"># # total fluxes from simulation runs</span></span>
<span id="cb60-70"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-70" aria-hidden="true" tabindex="-1"></a><span class="co"># flux_summary</span></span>
<span id="cb60-71"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-71" aria-hidden="true" tabindex="-1"></a><span class="co"># # RMSE from leave-one-out cross validation from simulation runs</span></span>
<span id="cb60-72"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-72" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse</span></span>
<span id="cb60-73"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-74"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="co"># names(mtcars)</span></span>
<span id="cb60-75"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-75" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(lm(mpg~cyl, data = mtcars))</span></span>
<span id="cb60-76"><a href="ok-with-structural-model-and-sampling-variance.html#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="co"># cov(mtcars[1:2])</span></span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="ordinary-kriging-just-in-space.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="footnotes-and-citations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-kriging.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
